{"version":3,"sources":["../src/credentialstore/linux/file-token-storage.ts"],"names":[],"mappings":"AAAA;;;+FAG+F;AAC/F,YAAY,CAAC;;AAEb,uBAAuB;AACvB,yBAAyB;AACzB,6BAA6B;AAE7B;;;;;GAKG;AACH;IAGI,YAAY,QAAgB;QACxB,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;IAC9B,CAAC;IAEM,UAAU,CAAC,UAAsB,EAAE,eAA2B;QACjE,MAAM,OAAO,GAAe,eAAe,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QAC/D,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;IACrC,CAAC;IAEM,KAAK;QACR,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;IAChC,CAAC;IAEM,WAAW;QACd,MAAM,QAAQ,GAAoB,CAAC,CAAC,KAAK,EAAE,CAAC;QAC5C,IAAI,OAAO,GAAe,EAAE,CAAC;QAC7B,IAAI,GAAQ,CAAC;QAEb,IAAI,CAAC;YACD,MAAM,OAAO,GAAW,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,EAAE,EAAC,QAAQ,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,EAAC,CAAC,CAAC;YACvF,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;YAC9B,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QAC9B,CAAC;QAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YACV,EAAE,CAAC,CAAC,EAAE,CAAC,IAAI,KAAK,QAAQ,CAAC,CAAC,CAAC;gBACvB,GAAG,GAAG,EAAE,CAAC;gBACT,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YACzB,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,6DAA6D;gBAC7D,uCAAuC;gBACvC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;YACzB,CAAC;QACL,CAAC;QACD,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC;IAC5B,CAAC;IAEM,aAAa,CAAC,aAAyB,CAAC,kCAAkC;QAC7E,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;IAC3C,CAAC;IAEO,WAAW,CAAC,OAAmB;QACnC,MAAM,KAAK,GAAqB,CAAC,CAAC,KAAK,EAAQ,CAAC;QAEhD,MAAM,YAAY,GAAG;YACjB,QAAQ,EAAE,MAAM;YAChB,IAAI,EAAE,GAAG;YACT,IAAI,EAAE,GAAG;SACZ,CAAC;QAEF,2DAA2D;QAC3D,MAAM,MAAM,GAAW,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACpD,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YACzB,EAAE,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;QACzB,CAAC;QACD,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,EAAE,YAAY,EAAE,CAAC,GAAG;YACpE,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;gBACN,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YACtB,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;YAC7B,CAAC;QACL,CAAC,CAAC,CAAC;QACH,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC;IACzB,CAAC;CACJ;AAjED,4CAiEC","file":"file-token-storage.js","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n*  Copyright (c) Microsoft Corporation. All rights reserved.\r\n*  Licensed under the MIT License. See License.txt in the project root for license information.\r\n*--------------------------------------------------------------------------------------------*/\r\n\"use strict\";\r\n\r\nimport * as Q from \"q\";\r\nimport * as fs from \"fs\";\r\nimport * as path from \"path\";\r\n\r\n/*\r\n    Provides storage of credentials in a file on the local file system.\r\n    Does not support any kind of 'prefix' of the credential (since this\r\n    storage mechanism is not shared with either Windows or OSX).  The\r\n    file is secured as RW for the owner of the process.\r\n */\r\nexport class FileTokenStorage {\r\n    private _filename: string;\r\n\r\n    constructor(filename: string) {\r\n        this._filename = filename;\r\n    }\r\n\r\n    public AddEntries(newEntries: Array<any>, existingEntries: Array<any>) : Q.Promise<void> {\r\n        const entries: Array<any> = existingEntries.concat(newEntries);\r\n        return this.saveEntries(entries);\r\n    }\r\n\r\n    public Clear() : Q.Promise<void> {\r\n        return this.saveEntries([]);\r\n    }\r\n\r\n    public LoadEntries() : Q.Promise<any> {\r\n        const deferred: Q.Deferred<any> = Q.defer();\r\n        let entries: Array<any> = [];\r\n        let err: any;\r\n\r\n        try {\r\n            const content: string = fs.readFileSync(this._filename, {encoding: \"utf8\", flag: \"r\"});\r\n            entries = JSON.parse(content);\r\n            deferred.resolve(entries);\r\n        } catch (ex) {\r\n            if (ex.code !== \"ENOENT\") {\r\n                err = ex;\r\n                deferred.reject(err);\r\n            } else {\r\n                // If it is ENOENT (the file doesn't exist or can't be found)\r\n                // Return an empty array (no items yet)\r\n                deferred.resolve([]);\r\n            }\r\n        }\r\n        return deferred.promise;\r\n    }\r\n\r\n    public RemoveEntries(entriesToKeep: Array<any> /*, entriesToRemove?: Array<any>*/) : Q.Promise<void> {\r\n        return this.saveEntries(entriesToKeep);\r\n    }\r\n\r\n    private saveEntries(entries: Array<any>) : Q.Promise<void> {\r\n        const defer: Q.Deferred<void> = Q.defer<void>();\r\n\r\n        const writeOptions = {\r\n            encoding: \"utf8\",\r\n            mode: 384, // Permission 0600 - owner read/write, nobody else has access\r\n            flag: \"w\"\r\n        };\r\n\r\n        // If the path we want to store in doesn't exist, create it\r\n        const folder: string = path.dirname(this._filename);\r\n        if (!fs.existsSync(folder)) {\r\n            fs.mkdirSync(folder);\r\n        }\r\n        fs.writeFile(this._filename, JSON.stringify(entries), writeOptions, (err) => {\r\n            if (err) {\r\n                defer.reject(err);\r\n            } else {\r\n                defer.resolve(undefined);\r\n            }\r\n        });\r\n        return defer.promise;\r\n    }\r\n}\r\n"],"sourceRoot":"C:\\Users\\jorit\\Desktop\\vsts-vscode\\out"}